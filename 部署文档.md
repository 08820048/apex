# ApexBlog éƒ¨ç½²æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ApexBlog æ˜¯ä¸€ä¸ªåŸºäº Spring Boot 3.x çš„ç°ä»£åŒ–åšå®¢ç³»ç»Ÿï¼Œæ”¯æŒå‰åç«¯åˆ†ç¦»æ¶æ„ã€‚

### æŠ€æœ¯æ ˆ
- **åç«¯**: Spring Boot 3.3.5 + Java 17
- **æ•°æ®åº“**: MySQL 8.0
- **ç¼“å­˜**: å†…å­˜ç¼“å­˜ (Simple Cache)
- **è®¤è¯**: JWT Token
- **APIæ–‡æ¡£**: SpringDoc OpenAPI 3
- **å‰ç«¯**: é™æ€æ–‡ä»¶éƒ¨ç½²
- **æ„å»ºå·¥å…·**: Gradle

### ç³»ç»Ÿæ¶æ„
```
å‰ç«¯é™æ€æ–‡ä»¶ (Nginx) â†’ åç«¯API (Spring Boot :8888/api) â†’ MySQL æ•°æ®åº“
```

## âš ï¸ å¸¸è§éƒ¨ç½²é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼Œè¯·å‚è€ƒå¯¹åº”è§£å†³æ–¹æ¡ˆï¼š

### 1. æ•°æ®åº“è¿æ¥è¢«æ‹’ç»
**é”™è¯¯**: `Access denied for user 'root'@'localhost'`
**åŸå› **: MySQL 8.0 è®¤è¯æ–¹å¼å…¼å®¹æ€§é—®é¢˜
**è§£å†³**: ä¿®æ”¹ä¸º `mysql_native_password` è®¤è¯æ–¹å¼
```bash
mysql -u root -p -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'your_password';"
```

### 2. åº”ç”¨å¯åŠ¨åæ— æ³•è®¿é—®
**ç°è±¡**: systemdæ˜¾ç¤ºæœåŠ¡è¿è¡Œï¼Œä½†8888ç«¯å£æ— æ³•è®¿é—®
**æ’æŸ¥**: æ‰‹åŠ¨å¯åŠ¨åº”ç”¨æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
```bash
sudo systemctl stop apexblog
java -jar /opt/apex/apex-blog-1.0.0.jar --spring.profiles.active=prod
```

### 3. Nginxé…ç½®é€‰æ‹©
**æ–¹æ¡ˆ1**: è·¯å¾„åˆ†ç¦» - ç®¡ç†åå°é€šè¿‡ `/admin` è·¯å¾„è®¿é—®
**æ–¹æ¡ˆ2**: å­åŸŸååˆ†ç¦» - ç®¡ç†åå°é€šè¿‡ `admin.domain.com` è®¿é—®
æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆï¼Œè¯¦è§ç¬¬6æ­¥é…ç½®è¯´æ˜ã€‚

## ğŸ”§ ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **CPU**: 2æ ¸å¿ƒä»¥ä¸Š
- **å†…å­˜**: 4GB RAM ä»¥ä¸Š
- **ç£ç›˜**: 20GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥

### è½¯ä»¶è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04+ / CentOS 8+ / Debian 11+
- **Java**: OpenJDK 17
- **MySQL**: 8.0+
- **Nginx**: 1.18+

## ğŸ“¦ éƒ¨ç½²å‡†å¤‡

### 1. æ„å»ºé¡¹ç›®

#### åç«¯æ„å»º
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./gradlew clean bootJar

# ç”Ÿæˆçš„JARæ–‡ä»¶ä½ç½®
build/libs/apex-blog-1.0.0.jar
```

#### å‰ç«¯æ„å»º
ç¡®ä¿ `frontend/dist` å’Œ `admin/dist` ç›®å½•åŒ…å«æ„å»ºå¥½çš„é™æ€æ–‡ä»¶ã€‚

### 2. å‡†å¤‡éƒ¨ç½²æ–‡ä»¶

#### 2.1 æœ¬åœ°å‡†å¤‡æ–‡ä»¶
åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•ä¸­å‡†å¤‡ä»¥ä¸‹æ–‡ä»¶ï¼š
```
æœ¬åœ°é¡¹ç›®ç›®å½•:
â”œâ”€â”€ build/libs/apex-blog-1.0.0.jar    # åç«¯åº”ç”¨ (./gradlew bootJar ç”Ÿæˆ)
â”œâ”€â”€ apex_blog.sql                      # æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ (åŒ…å«å®Œæ•´çš„è¡¨ç»“æ„å’Œæ•°æ®)
â”œâ”€â”€ frontend/dist/                     # å‰ç«¯é™æ€æ–‡ä»¶
â””â”€â”€ admin/dist/                        # ç®¡ç†åå°é™æ€æ–‡ä»¶
```

#### 2.2 ä¸Šä¼ åˆ°æœåŠ¡å™¨
å°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„éƒ¨ç½²ç›®å½• `/opt/apex/`ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºéƒ¨ç½²ç›®å½•
mkdir -p /opt/apex

# ä½¿ç”¨ scp ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ (åœ¨æœ¬åœ°æ‰§è¡Œ)
scp build/libs/apex-blog-1.0.0.jar root@your-server-ip:/opt/apex/
scp apex_blog.sql root@your-server-ip:/opt/apex/
scp -r frontend/dist root@your-server-ip:/opt/apex/frontend/
scp -r admin/dist root@your-server-ip:/opt/apex/admin/

# æˆ–è€…ä½¿ç”¨ SFTP å·¥å…· (å¦‚ FileZilla, WinSCP ç­‰) ä¸Šä¼ åˆ° /opt/apex/
```

**æ³¨æ„**: é¡¹ç›®å·²åŒ…å«å®Œæ•´çš„é…ç½®æ–‡ä»¶ï¼š
- `src/main/resources/application.yml` - ä¸»é…ç½®æ–‡ä»¶
- `src/main/resources/application-dev.yml` - å¼€å‘ç¯å¢ƒé…ç½®
- `src/main/resources/application-prod.yml` - ç”Ÿäº§ç¯å¢ƒé…ç½®

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: ç³»ç»Ÿå‡†å¤‡

#### 1.1 æ£€æŸ¥å’Œå¼€æ”¾ç«¯å£
```bash
# æ£€æŸ¥å½“å‰å¼€æ”¾çš„ç«¯å£
sudo netstat -tlnp

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# å¼€æ”¾å¿…è¦çš„ç«¯å£
sudo ufw allow 22      # SSH
sudo ufw allow 80      # HTTP
sudo ufw allow 443     # HTTPS
sudo ufw allow 3306    # MySQL (å¯é€‰ï¼Œä»…æœ¬åœ°è®¿é—®å¯ä¸å¼€æ”¾)
sudo ufw allow 8888    # åº”ç”¨ç«¯å£ (å¯é€‰ï¼Œé€šè¿‡Nginxä»£ç†å¯ä¸å¼€æ”¾)

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# ç¡®è®¤ç«¯å£å¼€æ”¾çŠ¶æ€
sudo ufw status numbered
```

#### 1.2 æ£€æŸ¥ç«¯å£å ç”¨
```bash
# æ£€æŸ¥å…³é”®ç«¯å£æ˜¯å¦è¢«å ç”¨
sudo lsof -i :80    # HTTPç«¯å£
sudo lsof -i :443   # HTTPSç«¯å£
sudo lsof -i :3306  # MySQLç«¯å£
sudo lsof -i :8888  # åº”ç”¨ç«¯å£

# å¦‚æœç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥åœæ­¢ç›¸å…³æœåŠ¡
# sudo systemctl stop service_name
```

### æ­¥éª¤ 2: ç¯å¢ƒå®‰è£…

#### 2.1 å®‰è£… Java 17
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install openjdk-17-jdk -y

# CentOS/RHEL
sudo yum install java-17-openjdk-devel -y

# éªŒè¯å®‰è£…
java -version
```

#### 2.2 å®‰è£… MySQL 8.0
```bash
# Ubuntu/Debian
sudo apt install mysql-server -y

# CentOS/RHEL
sudo yum install mysql-server -y

# å¯åŠ¨æœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰å…¨é…ç½®
sudo mysql_secure_installation
```

#### 2.3 å®‰è£… Nginx
```bash
# Ubuntu/Debian
sudo apt install nginx -y

# CentOS/RHEL
sudo yum install nginx -y

# å¯åŠ¨æœåŠ¡
sudo systemctl start nginx
sudo systemctl enable nginx
```

### æ­¥éª¤ 3: æ•°æ®åº“é…ç½®

#### 3.1 åˆ›å»ºæ•°æ®åº“
```bash
# ç™»å½• MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE apex_blog CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# é€€å‡º MySQL
EXIT;
```

#### 3.2 å¯¼å…¥æ•°æ®åº“å¤‡ä»½
```bash
# å¯¼å…¥è¡¨ç»“æ„å’Œæ•°æ®åˆ°æŒ‡å®šæ•°æ®åº“
mysql -u root -p apex_blog < /opt/apex/apex_blog.sql
```

**æ³¨æ„**: `apex_blog.sql` åŒ…å«è¡¨ç»“æ„å’Œæ•°æ®ï¼Œä½†ä¸åŒ…å«æ•°æ®åº“åˆ›å»ºè¯­å¥ï¼Œéœ€è¦å…ˆæ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“ã€‚

### æ­¥éª¤ 4: åº”ç”¨éƒ¨ç½²

#### 4.1 åˆ›å»ºWebå’Œæ—¥å¿—ç›®å½•
```bash
sudo mkdir -p /var/www/apexblog/frontend
sudo mkdir -p /var/www/apexblog/admin
sudo mkdir -p /var/log/apexblog
```

#### 4.2 éƒ¨ç½²åº”ç”¨æ–‡ä»¶
```bash
# JARæ–‡ä»¶å·²åœ¨ /opt/apex/ ç›®å½•ä¸­ï¼Œæ— éœ€ç§»åŠ¨

# å¤åˆ¶å‰ç«¯æ–‡ä»¶åˆ°Webç›®å½•
sudo cp -r /opt/apex/frontend/dist/* /var/www/apexblog/frontend/
sudo cp -r /opt/apex/admin/dist/* /var/www/apexblog/admin/

# è®¾ç½®æƒé™
sudo chown -R www-data:www-data /var/www/apexblog
sudo chmod -R 755 /var/www/apexblog
```

#### 4.3 ç”Ÿäº§ç¯å¢ƒé…ç½®
é¡¹ç›®å·²åŒ…å«å®Œæ•´çš„ `application-prod.yml` é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¸å¼€å‘ç¯å¢ƒåŸºæœ¬ç›¸åŒã€‚

å¦‚éœ€ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼Œå¯ä»¥ï¼š
1. **ç›´æ¥ä¿®æ”¹æºç **: ç¼–è¾‘ `src/main/resources/application-prod.yml` åé‡æ–°æ„å»º
2. **å¤–éƒ¨é…ç½®æ–‡ä»¶**: åœ¨éƒ¨ç½²ç›®å½•åˆ›å»º `application-prod.yml` è¦†ç›–JARåŒ…ä¸­çš„é…ç½®

ä¸»è¦å¯èƒ½éœ€è¦ä¿®æ”¹çš„é…ç½®é¡¹ï¼š
- æ•°æ®åº“è¿æ¥ä¿¡æ¯ (ç”¨æˆ·åã€å¯†ç )
- é‚®ä»¶æœåŠ¡é…ç½®
- åšå®¢åŸºæœ¬ä¿¡æ¯ (æ ‡é¢˜ã€ä½œè€…ã€åŸŸåç­‰)
- æ—¥å¿—æ–‡ä»¶è·¯å¾„

### æ­¥éª¤ 5: ç³»ç»ŸæœåŠ¡é…ç½®

#### 5.1 åˆ›å»ºç³»ç»ŸæœåŠ¡
```bash
sudo tee /etc/systemd/system/apexblog.service << 'EOF'
[Unit]
Description=ApexBlog Application
After=network.target mysql.service
Requires=mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/apex
ExecStart=/usr/bin/java -jar -Xms512m -Xmx1024m /opt/apex/apex-blog-1.0.0.jar --spring.profiles.active=prod
ExecStop=/bin/kill -15 $MAINPID
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal

Environment=JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
Environment=SPRING_PROFILES_ACTIVE=prod

[Install]
WantedBy=multi-user.target
EOF
```

#### 5.2 å¯åŠ¨åº”ç”¨æœåŠ¡
```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl enable apexblog
sudo systemctl start apexblog

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status apexblog
```

### æ­¥éª¤ 6: Nginx é…ç½®

#### 6.1 åˆ›å»º Nginx é…ç½®æ–‡ä»¶

**æ–¹æ¡ˆ1: è·¯å¾„åˆ†ç¦»ï¼ˆæ¨èï¼‰**
```bash
sudo tee /etc/nginx/sites-available/apexblog << 'EOF'
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/apexblog/frontend;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # ç®¡ç†åå°
    location /admin {
        alias /var/www/apexblog/admin;
        index index.html;
        try_files $uri $uri/ /admin/index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:8888/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/apexblog.access.log;
    error_log /var/log/nginx/apexblog.error.log;
}
EOF
```

**æ–¹æ¡ˆ2: å­åŸŸååˆ†ç¦»ï¼ˆæ¨èï¼Œæ”¯æŒHTTPSï¼‰**
```bash
sudo tee /etc/nginx/sites-available/apexblog << 'EOF'
# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name ilikexff.cn www.ilikexff.cn admin.ilikexff.cn;
    return 301 https://$server_name$request_uri;
}

# ä¸»ç«™ HTTPS
server {
    listen 443 ssl http2;
    server_name ilikexff.cn www.ilikexff.cn;

    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/ilikexff.cn/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/ilikexff.cn/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    # å‰ç«¯é™æ€æ–‡ä»¶ - æŒ‡å‘ dist æ–‡ä»¶å¤¹
    location / {
        root /var/www/apexblog/frontend/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†åˆ°åç«¯
    location /api/ {
        proxy_pass http://localhost:8888/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Port $server_port;

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/apexblog.access.log;
    error_log /var/log/nginx/apexblog.error.log;
}

# ç®¡ç†åå° HTTPS
server {
    listen 443 ssl http2;
    server_name admin.ilikexff.cn;

    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/ilikexff.cn/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/ilikexff.cn/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    # ç®¡ç†åå°é™æ€æ–‡ä»¶ - æŒ‡å‘ dist æ–‡ä»¶å¤¹
    location / {
        root /var/www/apexblog/admin/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # API ä»£ç†åˆ°åç«¯
    location /api/ {
        proxy_pass http://localhost:8888/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Port $server_port;

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/admin.access.log;
    error_log /var/log/nginx/admin.error.log;
}
EOF
```

**æ³¨æ„**:
- æ–¹æ¡ˆ1è®¿é—®åœ°å€: å‰å° `http://your-domain.com`ï¼Œç®¡ç†åå° `http://your-domain.com/admin`
- æ–¹æ¡ˆ2è®¿é—®åœ°å€: å‰å° `https://ilikexff.cn`ï¼Œç®¡ç†åå° `https://admin.ilikexff.cn`
- ä½¿ç”¨æ–¹æ¡ˆ2æ—¶éœ€è¦ç¡®ä¿DNSè§£æä¸­é…ç½®äº†å­åŸŸå `admin.ilikexff.cn`
- **é‡è¦**: é…ç½®ä¸­çš„ `root` è·¯å¾„æŒ‡å‘ `dist` æ–‡ä»¶å¤¹ï¼Œå‰ç«¯ä¸Šä¼ æ—¶ç›´æ¥ä¸Šä¼  `dist` æ–‡ä»¶å¤¹å³å¯

#### 6.1.1 å‰ç«¯ç¯å¢ƒå˜é‡é…ç½®

åœ¨é‡æ–°æ„å»ºå‰ç«¯ä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹ç¯å¢ƒå˜é‡é…ç½®ï¼š

**ä¸»ç«™å‰ç«¯é…ç½®** (`frontend/.env.production`):
```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®
VITE_APP_TITLE=å…«å°ºå¦–å‰‘
VITE_API_BASE_URL=https://ilikexff.cn/api
VITE_SERVER_HOST=ilikexff.cn
VITE_DEBUG=false
VITE_ENABLE_QUERY_STATS=true
```

**ç®¡ç†åå°é…ç½®** (`admin/.env.production`):
```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®
VITE_APP_TITLE=å…«å°ºå¦–å‰‘ - ç®¡ç†åå°
VITE_API_BASE_URL=https://admin.ilikexff.cn/api
VITE_SERVER_HOST=admin.ilikexff.cn
VITE_DEBUG=false
VITE_ENABLE_QUERY_STATS=true
```

**å‰ç«¯é‡æ–°éƒ¨ç½²æµç¨‹**:
```bash
# 1. ä¿®æ”¹ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
# 2. é‡æ–°æ„å»ºå‰ç«¯
cd frontend && npm run build
cd ../admin && npm run build

# 3. ç›´æ¥ä¸Šä¼  dist æ–‡ä»¶å¤¹åˆ°æœåŠ¡å™¨
scp -r frontend/dist root@server:/var/www/apexblog/frontend/
scp -r admin/dist root@server:/var/www/apexblog/admin/

# 4. è®¾ç½®æƒé™
sudo chown -R www-data:www-data /var/www/apexblog
sudo chmod -R 755 /var/www/apexblog
```

#### 6.1.2 åç«¯æ›´æ–°éƒ¨ç½²æµç¨‹

å½“åç«¯ä»£ç æœ‰æ›´æ–°æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

**æ­¥éª¤1: æœ¬åœ°æ„å»ºæ–°çš„JARåŒ…**
```bash
# åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./gradlew clean bootJar

# æ„å»ºå®Œæˆåï¼ŒJARåŒ…ä½äºï¼šbuild/libs/apex-blog-1.0.0.jar
```

**æ­¥éª¤2: ä¸Šä¼ æ–°çš„JARåŒ…åˆ°æœåŠ¡å™¨**
```bash
# ä¸Šä¼ æ–°çš„JARåŒ…ï¼ˆè¦†ç›–æ—§ç‰ˆæœ¬ï¼‰
scp build/libs/apex-blog-1.0.0.jar root@server:/opt/apex/

# æˆ–è€…å¤‡ä»½æ—§ç‰ˆæœ¬åå†ä¸Šä¼ 
scp build/libs/apex-blog-1.0.0.jar root@server:/opt/apex/apex-blog-1.0.0.jar.new
```

**æ­¥éª¤3: åœ¨æœåŠ¡å™¨ä¸Šé‡å¯åº”ç”¨**
```bash
# åœæ­¢å½“å‰è¿è¡Œçš„åº”ç”¨
sudo systemctl stop apexblog

# å¤‡ä»½å½“å‰JARåŒ…ï¼ˆå¯é€‰ï¼‰
sudo cp /opt/apex/apex-blog-1.0.0.jar /opt/apex/apex-blog-1.0.0.jar.backup.$(date +%Y%m%d_%H%M%S)

# å¦‚æœä½¿ç”¨äº†.newæ–‡ä»¶ï¼Œé‡å‘½å
sudo mv /opt/apex/apex-blog-1.0.0.jar.new /opt/apex/apex-blog-1.0.0.jar

# å¯åŠ¨åº”ç”¨
sudo systemctl start apexblog

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status apexblog

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
sudo journalctl -u apexblog -f --lines=50
```

**æ­¥éª¤4: éªŒè¯éƒ¨ç½²**
```bash
# æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
curl -I https://ilikexff.cn/api/actuator/health

# æ£€æŸ¥åº”ç”¨æ—¥å¿—
sudo tail -f /var/log/apexblog/apex-blog.log
```

**å¿«é€Ÿé‡å¯è„šæœ¬**ï¼ˆå¯é€‰ï¼‰:
```bash
# åˆ›å»ºå¿«é€Ÿéƒ¨ç½²è„šæœ¬
sudo tee /opt/apex/restart-app.sh << 'EOF'
#!/bin/bash
echo "åœæ­¢åº”ç”¨..."
sudo systemctl stop apexblog

echo "å¤‡ä»½å½“å‰ç‰ˆæœ¬..."
sudo cp /opt/apex/apex-blog-1.0.0.jar /opt/apex/apex-blog-1.0.0.jar.backup.$(date +%Y%m%d_%H%M%S)

echo "å¯åŠ¨åº”ç”¨..."
sudo systemctl start apexblog

echo "æ£€æŸ¥çŠ¶æ€..."
sleep 5
sudo systemctl status apexblog

echo "æ£€æŸ¥å¥åº·çŠ¶æ€..."
curl -I https://ilikexff.cn/api/actuator/health
EOF

# è®¾ç½®æ‰§è¡Œæƒé™
sudo chmod +x /opt/apex/restart-app.sh

# ä½¿ç”¨æ–¹æ³•ï¼š
# sudo /opt/apex/restart-app.sh
```

#### 6.2 å¯ç”¨é…ç½®å¹¶é‡å¯ Nginx
```bash
# å¯ç”¨ç«™ç‚¹é…ç½®
sudo ln -s /etc/nginx/sites-available/apexblog /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

## ï¿½ æ›´æ–°éƒ¨ç½²

### å‰ç«¯æ›´æ–°
å½“å‰ç«¯ä»£ç æœ‰æ›´æ–°æ—¶ï¼š

```bash
# 1. æœ¬åœ°é‡æ–°æ„å»º
cd frontend && npm run build
cd ../admin && npm run build

# 2. ç›´æ¥ä¸Šä¼ è¦†ç›–
scp -r frontend/dist root@server:/var/www/apexblog/frontend/
scp -r admin/dist root@server:/var/www/apexblog/admin/

# 3. è®¾ç½®æƒé™
sudo chown -R www-data:www-data /var/www/apexblog
sudo chmod -R 755 /var/www/apexblog

# 4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æµ‹è¯•
```

### åç«¯æ›´æ–°
å½“åç«¯ä»£ç æœ‰æ›´æ–°æ—¶ï¼š

```bash
# 1. æœ¬åœ°é‡æ–°æ„å»º
./gradlew clean bootJar

# 2. ä¸Šä¼ æ–°JARåŒ…
scp build/libs/apex-blog-1.0.0.jar root@server:/opt/apex/

# 3. æœåŠ¡å™¨ä¸Šé‡å¯åº”ç”¨
sudo systemctl stop apexblog
sudo systemctl start apexblog

# 4. éªŒè¯éƒ¨ç½²
sudo systemctl status apexblog
curl -I https://ilikexff.cn/api/actuator/health
```

### æ•°æ®åº“æ›´æ–°
å¦‚æœæœ‰æ•°æ®åº“ç»“æ„å˜æ›´ï¼š

```bash
# 1. å¤‡ä»½å½“å‰æ•°æ®åº“
mysqldump -u root -p apex_blog > backup_$(date +%Y%m%d_%H%M%S).sql

# 2. æ‰§è¡ŒSQLæ›´æ–°è„šæœ¬
mysql -u root -p apex_blog < update_script.sql

# 3. é‡å¯åº”ç”¨ä»¥åº”ç”¨æ–°çš„æ•°æ®åº“ç»“æ„
sudo systemctl restart apexblog
```

## ï¿½ğŸ”’ SSL è¯ä¹¦é…ç½® (å¯é€‰)

### ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# ç”³è¯·è¯ä¹¦ï¼ˆåŒ…å«æ‰€æœ‰å­åŸŸåï¼‰
sudo certbot --nginx -d ilikexff.cn -d www.ilikexff.cn -d admin.ilikexff.cn

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œ
0 12 * * * /usr/bin/certbot renew --quiet

# éªŒè¯è¯ä¹¦çŠ¶æ€
sudo certbot certificates
```

## ï¿½ éƒ¨ç½²éªŒè¯

### æ£€æŸ¥æœåŠ¡å’Œç«¯å£
```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status apexblog
sudo systemctl status mysql
sudo systemctl status nginx

# æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€
sudo netstat -tlnp | grep -E "(80|443|3306|8888)"

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
sudo ufw status

# æµ‹è¯•æœ¬åœ°è¿æ¥
curl -I http://localhost:8888/api/actuator/health
curl -I http://localhost:80
```

## ï¿½ğŸ“Š æœåŠ¡ç®¡ç†

### å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
sudo systemctl status apexblog

# é‡å¯åº”ç”¨
sudo systemctl restart apexblog

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
sudo journalctl -u apexblog -f

# æŸ¥çœ‹åº”ç”¨ä¸šåŠ¡æ—¥å¿—
sudo tail -f /var/log/apexblog/apex-blog.log

# é‡å¯ Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/apexblog.access.log
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### åº”ç”¨æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u apexblog -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 8888

# æ£€æŸ¥é…ç½®æ–‡ä»¶
sudo cat /opt/apexblog/application-prod.yml
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

**å¸¸è§é”™è¯¯**: `Access denied for user 'root'@'localhost'`

**åŸå› **: MySQL 8.0 é»˜è®¤ä½¿ç”¨ `caching_sha2_password` è®¤è¯æ–¹å¼ï¼ŒJavaåº”ç”¨å¯èƒ½ä¸å…¼å®¹

**è§£å†³æ­¥éª¤**:

1. **æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€**:
```bash
sudo systemctl status mysql
```

2. **æµ‹è¯•å‘½ä»¤è¡Œè¿æ¥**:
```bash
mysql -u root -p5247xff -e "SELECT 1;"
```

3. **å¦‚æœå‘½ä»¤è¡Œè¿æ¥æ­£å¸¸ä½†åº”ç”¨è¿æ¥å¤±è´¥ï¼Œä¿®æ”¹è®¤è¯æ–¹å¼**:
```bash
mysql -u root -p5247xff -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '5247xff';"
```

4. **éªŒè¯æ•°æ®åº“å’Œè¡¨æ˜¯å¦å­˜åœ¨**:
```bash
# æ£€æŸ¥æ•°æ®åº“
mysql -u root -p5247xff -e "SHOW DATABASES;" | grep apex_blog

# æ£€æŸ¥æ•°æ®è¡¨
mysql -u root -p5247xff apex_blog -e "SHOW TABLES;"
```

5. **æ‰‹åŠ¨å¯åŠ¨åº”ç”¨æµ‹è¯•**:
```bash
# åœæ­¢systemdæœåŠ¡
sudo systemctl stop apexblog

# æ‰‹åŠ¨å¯åŠ¨æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cd /opt/apex
java -jar apex-blog-1.0.0.jar --spring.profiles.active=prod
```

6. **å¦‚æœæ‰‹åŠ¨å¯åŠ¨æˆåŠŸï¼Œé‡æ–°å¯åŠ¨systemdæœåŠ¡**:
```bash
# æŒ‰Ctrl+Cåœæ­¢æ‰‹åŠ¨å¯åŠ¨
sudo systemctl start apexblog
sudo systemctl status apexblog
```

**å…¶ä»–æ•°æ®åº“é—®é¢˜æ’æŸ¥**:
```bash
# æŸ¥çœ‹æ•°æ®åº“å’Œç”¨æˆ·
mysql -u root -p -e "SHOW DATABASES; SELECT user, host FROM mysql.user;"

# æ£€æŸ¥ç”¨æˆ·æƒé™
mysql -u root -p -e "SHOW GRANTS FOR 'root'@'localhost';"
```

### Nginx 502 é”™è¯¯
```bash
# æ£€æŸ¥åº”ç”¨æ˜¯å¦è¿è¡Œ
curl -I http://localhost:8888/api/actuator/health

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -20 /var/log/nginx/apexblog.error.log
```

## ğŸ¯ è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

**æ–¹æ¡ˆ1 (è·¯å¾„åˆ†ç¦»)**:
- **å‰ç«¯ç½‘ç«™**: http://your-domain.com
- **ç®¡ç†åå°**: http://your-domain.com/admin
- **APIæ–‡æ¡£**: http://your-domain.com/api/swagger-ui.html
- **å¥åº·æ£€æŸ¥**: http://your-domain.com/api/actuator/health

**æ–¹æ¡ˆ2 (å­åŸŸååˆ†ç¦» + HTTPS) - å½“å‰é…ç½®**:
- **å‰ç«¯ç½‘ç«™**: https://ilikexff.cn
- **ç®¡ç†åå°**: https://admin.ilikexff.cn
- **APIæ–‡æ¡£**: https://ilikexff.cn/api/swagger-ui.html
- **å¥åº·æ£€æŸ¥**: https://ilikexff.cn/api/actuator/health

**æ³¨æ„**:
- å½“å‰ä½¿ç”¨æ–¹æ¡ˆ2ï¼Œæ‰€æœ‰HTTPè¯·æ±‚ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- DNSè§£æå·²é…ç½®å­åŸŸå `admin.ilikexff.cn` æŒ‡å‘æœåŠ¡å™¨IP
- SSLè¯ä¹¦è¦†ç›–æ‰€æœ‰åŸŸåï¼š`ilikexff.cn`, `www.ilikexff.cn`, `admin.ilikexff.cn`

## ğŸ“ é»˜è®¤è´¦å·

æ•°æ®åº“å¤‡ä»½ä¸­åŒ…å«çš„é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š
- **ç”¨æˆ·å**: xuyi
- **å¯†ç **: è¯·æŸ¥çœ‹æ•°æ®åº“å¤‡ä»½ä¸­çš„å®é™…æ•°æ® (å¯†ç å·²åŠ å¯†å­˜å‚¨)

**æ³¨æ„**: é¦–æ¬¡ç™»å½•åè¯·åŠæ—¶ä¿®æ”¹å¯†ç ï¼

---

**éƒ¨ç½²å®Œæˆï¼** ğŸ‰

è®°å¾—æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“å¯†ç ã€JWTå¯†é’¥ã€é‚®ä»¶é…ç½®ç­‰æ•æ„Ÿä¿¡æ¯ã€‚
